import{p as Pe,m as Be,v as Ke,x as je,i as _,j as R,c as z,q as Te,a as C,b as p,g,f as t,s as $,h as l,r as i,F as le,d as ae,o as r,e as c,t as d,k as s,y as pe,n as ge,w as G,z as ke,A as _e,B as ye,C as J}from"./index-Ckjzomrf.js";import{_ as He}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Oe={class:"shopping-list-view"},Ze={class:"d-flex align-center justify-space-between"},qe={class:"text-body-2"},Re={class:"d-flex align-center justify-space-between mb-2"},Ge={class:"text-body-2"},Je={class:"d-flex gap-4"},Qe={key:3},We={class:"vendor-header mb-2"},Xe={key:0,class:"text-medium-emphasis"},Ye={class:"d-flex align-center gap-1"},et={class:"text-caption"},tt={key:0},lt={__name:"ShoppingListView",setup(at){const m=Pe(),b=Be(),P=Ke(),Q=je(),B=_(!1),A=_(null),x=_(!1),v=_({name:"",amount:1,unit:"Stück",categoryId:null}),K=_(!1),V=_(!1),f=_({id:null,name:"",amount:1,unit:"Stück",categoryId:null}),j=_(!1),L=_(!1),D=_(!1),S=_(null),oe=_(!1),W=_(!1),X=_(!0);R(()=>v.value.name,o=>{if(K.value)return;if(!o||o.trim().length<2){v.value.categoryId=null;return}const e=o.toLowerCase().trim(),n=Q.products.find(k=>k.name.toLowerCase()===e);n&&n.categoryId&&(v.value.categoryId=n.categoryId)}),R(x,o=>{o&&(v.value={name:"",amount:1,unit:"Stück",categoryId:null},K.value=!1)}),R(()=>f.value.name,o=>{if(j.value||!o||o.trim().length<2)return;const e=o.toLowerCase().trim(),n=Q.products.find(k=>k.name.toLowerCase()===e);n&&n.categoryId&&(f.value.categoryId=n.categoryId)}),R(V,o=>{o||(f.value={id:null,name:"",amount:1,unit:"Stück",categoryId:null},j.value=!1)});const be=z(()=>m.shoppingList?.items?m.shoppingList.items.filter(o=>!(!W.value&&o.checked||!X.value&&o.freshnessStatus==="wait")):[]),ne=z(()=>{const o={};for(const e of be.value){const n=e.vendorName||"Sonstiges";o[n]||(o[n]={name:n,color:e.vendorColor||"#9CA3AF",items:[]}),o[n].items.push(e)}return Object.values(o)}),Y=z(()=>m.shoppingList?.items?.filter(o=>o.checked).length||0),I=z(()=>m.shoppingList?.items?.length||0),we=z(()=>Y.value>0),se=z(()=>{const o=[];o.push({value:null,title:"Sonstiges",subtitle:"Manuell hinzugefügt"});for(const e of P.vendors){const n=P.getCategoriesForVendor(e.id);for(const k of n)o.push({value:k.id,title:k.name,subtitle:e.name,vendorColor:e.color})}return o});function ue(o){m.toggleItem(o.id)}function he(){m.removeCheckedItems(),b.showSnackbar("Erledigte Artikel entfernt")}async function re(){if(!v.value.name.trim()){b.showSnackbar("Name ist erforderlich","error");return}try{const o=await J.addShoppingItem({productName:v.value.name.trim(),amount:parseFloat(v.value.amount)||1,unit:v.value.unit,categoryId:v.value.categoryId});m.shoppingList&&m.shoppingList.items.push(o),x.value=!1,v.value={name:"",amount:1,unit:"Stück",categoryId:null},K.value=!1,b.showSnackbar("Artikel hinzugefügt")}catch{b.showSnackbar("Fehler beim Hinzufügen","error")}}function Ce(o){A.value=o,B.value=!0}function xe(o){switch(o){case"today":return"error";case"wait":return"warning";default:return"success"}}function Ve(o){switch(o){case"today":return"mdi-clock-alert";case"wait":return"mdi-clock-outline";default:return"mdi-check-circle"}}function T(o){if(!o)return"";const e=new Date(o);return`${["So","Mo","Di","Mi","Do","Fr","Sa"][e.getDay()]}, ${e.getDate()}.${e.getMonth()+1}.`}Te(()=>{P.fetchVendors(),P.fetchCategories(),Q.fetchProducts(),m.loadCurrentList()});function Se(o){v.value.categoryId=o,K.value=!0}function Ie(o){f.value.categoryId=o,j.value=!0}function ze(o){if(!o.sources?.some(e=>e.manual)){b.showSnackbar("Nur manuell hinzugefügte Artikel können bearbeitet werden","warning");return}f.value={id:o.id,name:o.productName,amount:o.amount,unit:o.unit,categoryId:o.categoryId},j.value=!1,V.value=!0}async function ie(){if(!f.value.name.trim()){b.showSnackbar("Name ist erforderlich","error");return}try{await J.updateShoppingItem(f.value.id,{productName:f.value.name.trim(),amount:parseFloat(f.value.amount)||1,unit:f.value.unit,categoryId:f.value.categoryId}),await m.loadCurrentList(),V.value=!1,b.showSnackbar("Artikel aktualisiert")}catch{b.showSnackbar("Fehler beim Aktualisieren","error")}}function Ae(o){S.value=o,D.value=!0}async function Le(){if(S.value)try{if(await J.deleteShoppingItem(S.value.id),m.shoppingList?.items){const o=m.shoppingList.items.findIndex(e=>e.id===S.value.id);o!==-1&&m.shoppingList.items.splice(o,1)}D.value=!1,S.value=null,b.showSnackbar("Artikel gelöscht")}catch{b.showSnackbar("Fehler beim Löschen","error")}}async function De(){try{await J.clearShoppingList(),m.shoppingList&&(m.shoppingList.items=[]),L.value=!1,b.showSnackbar("Einkaufsliste geleert")}catch{b.showSnackbar("Fehler beim Leeren der Liste","error")}}return(o,e)=>{const n=i("v-btn"),k=i("v-icon"),H=i("v-list-item-title"),F=i("v-list-item"),ee=i("v-list"),Fe=i("v-menu"),w=i("v-card-text"),y=i("v-card"),Ee=i("v-progress-linear"),de=i("v-switch"),te=i("v-chip"),Ne=i("v-checkbox-btn"),O=i("v-list-item-subtitle"),Me=i("v-tooltip"),Ue=i("v-progress-circular"),E=i("v-card-title"),Z=i("v-text-field"),q=i("v-col"),me=i("v-combobox"),ce=i("v-row"),ve=i("v-avatar"),fe=i("v-select"),N=i("v-spacer"),M=i("v-card-actions"),U=i("v-dialog"),$e=i("v-card-subtitle");return r(),C("div",Oe,[$(m).shoppingList?(r(),p(y,{key:0,class:"mb-4",variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"pa-3"},{default:l(()=>[c("div",Ze,[c("div",null,[e[23]||(e[23]=c("div",{class:"text-subtitle-2 text-medium-emphasis"},"Einkaufsliste",-1)),c("div",qe," Zuletzt erstellt am "+d(T($(m).shoppingList.generatedAt.split("T")[0])),1)]),t(Fe,{modelValue:oe.value,"onUpdate:modelValue":e[1]||(e[1]=a=>oe.value=a),location:"bottom end"},{activator:l(({props:a})=>[t(n,pe({icon:"mdi-dots-vertical",variant:"text",size:"small"},a),null,16)]),default:l(()=>[t(ee,{density:"compact"},{default:l(()=>[t(F,{onClick:e[0]||(e[0]=a=>L.value=!0)},{prepend:l(()=>[t(k,{icon:"mdi-delete-sweep"})]),default:l(()=>[t(H,null,{default:l(()=>[...e[24]||(e[24]=[s("Liste leeren",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})):g("",!0),I.value>0?(r(),p(y,{key:1,class:"mb-4",variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"pa-3"},{default:l(()=>[c("div",Re,[c("span",Ge,d(Y.value)+" von "+d(I.value)+" erledigt",1),we.value?(r(),p(n,{key:0,variant:"text",color:"error",size:"small",onClick:he},{default:l(()=>[...e[25]||(e[25]=[s(" Erledigte löschen ",-1)])]),_:1})):g("",!0)]),t(Ee,{"model-value":Y.value/I.value*100,color:"primary",height:"8",rounded:""},null,8,["model-value"])]),_:1})]),_:1})):g("",!0),I.value>0?(r(),p(y,{key:2,class:"mb-4",variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"pa-3"},{default:l(()=>[c("div",Je,[t(de,{modelValue:W.value,"onUpdate:modelValue":e[2]||(e[2]=a=>W.value=a),color:"primary",label:"Erledigte anzeigen","hide-details":"",density:"compact"},null,8,["modelValue"]),t(de,{modelValue:X.value,"onUpdate:modelValue":e[3]||(e[3]=a=>X.value=a),color:"primary",label:"Zukünftige anzeigen","hide-details":"",density:"compact"},null,8,["modelValue"])])]),_:1})]),_:1})):g("",!0),$(m).shoppingList?(r(),C("div",Qe,[ne.value.length===0&&I.value>0?(r(),p(y,{key:0,variant:"flat",color:"surface",class:"mb-4"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(k,{icon:"mdi-filter-off-outline",size:"64",color:"warning",class:"mb-4"}),e[26]||(e[26]=c("div",{class:"text-h6 mb-2"},"Keine Artikel zum Anzeigen",-1)),e[27]||(e[27]=c("div",{class:"text-body-2 text-medium-emphasis"}," Alle Artikel sind für später vorgesehen. Deaktiviere den Filter, um sie zu sehen. ",-1))]),_:1})]),_:1})):g("",!0),I.value===0?(r(),p(y,{key:1,variant:"flat",color:"surface",class:"mb-4"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(k,{icon:"mdi-cart-outline",size:"64",color:"primary",class:"mb-4"}),e[28]||(e[28]=c("div",{class:"text-h6 mb-2"},"Einkaufsliste ist leer",-1)),e[29]||(e[29]=c("div",{class:"text-body-2 text-medium-emphasis"}," Füge Artikel manuell hinzu oder erstelle eine Liste aus deinen geplanten Mahlzeiten. ",-1))]),_:1})]),_:1})):g("",!0),(r(!0),C(le,null,ae(ne.value,a=>(r(),C("div",{key:a.name,class:"mb-4"},[c("div",We,[t(te,{color:a.color,variant:"flat",size:"small",label:""},{default:l(()=>[t(k,{start:"",icon:"mdi-store",size:"small"}),s(" "+d(a.name),1)]),_:2},1032,["color"])]),t(y,{variant:"flat",color:"surface"},{default:l(()=>[t(ee,{density:"compact"},{default:l(()=>[(r(!0),C(le,null,ae(a.items,u=>(r(),p(F,{key:u.id,class:ge({"item-checked":u.checked}),onClick:h=>ue(u)},{prepend:l(()=>[t(Ne,{"model-value":u.checked,color:"primary",onClick:G(h=>ue(u),["stop"])},null,8,["model-value","onClick"])]),append:l(()=>[c("div",Ye,[u.freshnessStatus==="wait"?(r(),p(Me,{key:0,location:"top"},{activator:l(({props:h})=>[t(k,pe({ref_for:!0},h,{icon:Ve(u.freshnessStatus),color:xe(u.freshnessStatus),size:"small"}),null,16,["icon","color"])]),default:l(()=>[c("div",null,[c("div",null," Frühestens kaufen ab: "+d(T(u.earliestPurchaseDate)),1),c("div",et," Benötigt am "+d(T(u.earliestUseDate)),1)])]),_:2},1024)):g("",!0),u.sources?.length?(r(),p(n,{key:1,icon:"mdi-information-outline",variant:"text",size:"x-small",onClick:G(h=>Ce(u),["stop"])},null,8,["onClick"])):g("",!0),u.sources?.some(h=>h.manual)?(r(),p(n,{key:2,icon:"mdi-pencil",variant:"text",size:"x-small",onClick:G(h=>ze(u),["stop"])},null,8,["onClick"])):g("",!0),u.sources?.some(h=>h.manual)?(r(),p(n,{key:3,icon:"mdi-delete",variant:"text",size:"x-small",color:"error",onClick:G(h=>Ae(u),["stop"])},null,8,["onClick"])):g("",!0)])]),default:l(()=>[t(H,{class:ge({"text-decoration-line-through":u.checked})},{default:l(()=>[s(d(u.productName),1)]),_:2},1032,["class"]),t(O,null,{default:l(()=>[s(d(u.displayAmount)+" ",1),u.categoryName?(r(),C("span",Xe," · "+d(u.categoryName),1)):g("",!0)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:2},1024)]),_:2},1024)]))),128))])):$(m).loading?(r(),p(y,{key:5,variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(Ue,{indeterminate:"",color:"primary"}),e[32]||(e[32]=c("div",{class:"mt-4"},"Lade Einkaufsliste...",-1))]),_:1})]),_:1})):(r(),p(y,{key:4,variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(k,{icon:"mdi-cart-outline",size:"64",color:"primary",class:"mb-4"}),e[30]||(e[30]=c("div",{class:"text-h6 mb-2"},"Keine Einkaufsliste",-1)),e[31]||(e[31]=c("div",{class:"text-body-2 text-medium-emphasis"},' Erstelle eine Einkaufsliste im Planer, indem du Mahlzeiten hinzufügst und auf "Einkaufsliste erstellen" klickst. ',-1))]),_:1})]),_:1})),$(m).shoppingList?(r(),p(n,{key:6,color:"accent",icon:"mdi-plus",size:"large",position:"fixed",location:"bottom end",class:"mb-16 mr-4",elevation:"4",onClick:e[4]||(e[4]=a=>x.value=!0)})):g("",!0),t(U,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=a=>x.value=a),"max-width":"400"},{default:l(()=>[t(y,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[33]||(e[33]=[s("Artikel hinzufügen",-1)])]),_:1}),t(w,null,{default:l(()=>[t(Z,{modelValue:v.value.name,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.name=a),label:"Produkt",autofocus:"",class:"mb-3",onKeyup:ke(re,["enter"])},null,8,["modelValue"]),t(ce,null,{default:l(()=>[t(q,{cols:"6"},{default:l(()=>[t(Z,{modelValue:v.value.amount,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value.amount=a),modelModifiers:{number:!0},label:"Menge",type:"number",min:"0",step:"0.1"},null,8,["modelValue"])]),_:1}),t(q,{cols:"6"},{default:l(()=>[t(me,{modelValue:v.value.unit,"onUpdate:modelValue":e[7]||(e[7]=a=>v.value.unit=a),items:["Stück","g","kg","ml","l","Packung","Bund"],label:"Einheit"},null,8,["modelValue"])]),_:1})]),_:1}),t(fe,{modelValue:v.value.categoryId,"onUpdate:modelValue":[e[8]||(e[8]=a=>v.value.categoryId=a),Se],items:se.value,"item-title":"title","item-value":"value",label:"Kategorie",class:"mt-3"},{item:l(({item:a,props:u})=>[t(F,_e(ye(u)),{prepend:l(()=>[t(ve,{color:a.raw.vendorColor||"#9CA3AF",size:"24",class:"mr-2"},{default:l(()=>[t(k,{icon:"mdi-store",size:"small",color:"white"})]),_:1},8,["color"])]),default:l(()=>[t(O,null,{default:l(()=>[s(d(a.raw.subtitle),1)]),_:2},1024)]),_:2},1040)]),selection:l(({item:a})=>[t(te,{color:a.raw.vendorColor||"#9CA3AF",size:"small",label:""},{default:l(()=>[s(d(a.raw.title)+" ("+d(a.raw.subtitle)+") ",1)]),_:2},1032,["color"])]),_:1},8,["modelValue","items"])]),_:1}),t(M,null,{default:l(()=>[t(N),t(n,{variant:"text",onClick:e[9]||(e[9]=a=>x.value=!1)},{default:l(()=>[...e[34]||(e[34]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"primary",onClick:re},{default:l(()=>[...e[35]||(e[35]=[s("Hinzufügen",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=a=>B.value=a),"max-width":"400"},{default:l(()=>[A.value?(r(),p(y,{key:0},{default:l(()=>[t(E,null,{default:l(()=>[s(d(A.value.productName),1)]),_:1}),t($e,null,{default:l(()=>[s(d(A.value.displayAmount),1)]),_:1}),t(w,null,{default:l(()=>[e[37]||(e[37]=c("div",{class:"text-subtitle-2 mb-2"},"Verwendet für:",-1)),t(ee,{density:"compact"},{default:l(()=>[(r(!0),C(le,null,ae(A.value.sources,(a,u)=>(r(),p(F,{key:u},{default:l(()=>[a.dishName?(r(),p(H,{key:0},{default:l(()=>[s(d(a.dishName),1)]),_:2},1024)):a.manual?(r(),p(H,{key:1},{default:l(()=>[...e[36]||(e[36]=[s(" Manuell hinzugefügt ",-1)])]),_:1})):g("",!0),a.mealDate?(r(),p(O,{key:2},{default:l(()=>[s(d(T(a.mealDate))+" · "+d(a.mealSlot)+" ",1),a.amount?(r(),C("span",tt," · "+d(a.amount)+" "+d(a.unit),1)):g("",!0)]),_:2},1024)):g("",!0)]),_:2},1024))),128))]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(N),t(n,{variant:"text",onClick:e[11]||(e[11]=a=>B.value=!1)},{default:l(()=>[...e[38]||(e[38]=[s("Schließen",-1)])]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),t(U,{modelValue:V.value,"onUpdate:modelValue":e[18]||(e[18]=a=>V.value=a),"max-width":"400"},{default:l(()=>[t(y,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[39]||(e[39]=[s("Artikel bearbeiten",-1)])]),_:1}),t(w,null,{default:l(()=>[t(Z,{modelValue:f.value.name,"onUpdate:modelValue":e[13]||(e[13]=a=>f.value.name=a),label:"Produkt",autofocus:"",class:"mb-3",onKeyup:ke(ie,["enter"])},null,8,["modelValue"]),t(ce,null,{default:l(()=>[t(q,{cols:"6"},{default:l(()=>[t(Z,{modelValue:f.value.amount,"onUpdate:modelValue":e[14]||(e[14]=a=>f.value.amount=a),modelModifiers:{number:!0},label:"Menge",type:"number",min:"0",step:"0.1"},null,8,["modelValue"])]),_:1}),t(q,{cols:"6"},{default:l(()=>[t(me,{modelValue:f.value.unit,"onUpdate:modelValue":e[15]||(e[15]=a=>f.value.unit=a),items:["Stück","g","kg","ml","l","Packung","Bund"],label:"Einheit"},null,8,["modelValue"])]),_:1})]),_:1}),t(fe,{modelValue:f.value.categoryId,"onUpdate:modelValue":[e[16]||(e[16]=a=>f.value.categoryId=a),Ie],items:se.value,"item-title":"title","item-value":"value",label:"Kategorie",class:"mt-3"},{item:l(({item:a,props:u})=>[t(F,_e(ye(u)),{prepend:l(()=>[t(ve,{color:a.raw.vendorColor||"#9CA3AF",size:"24",class:"mr-2"},{default:l(()=>[t(k,{icon:"mdi-store",size:"small",color:"white"})]),_:1},8,["color"])]),default:l(()=>[t(O,null,{default:l(()=>[s(d(a.raw.subtitle),1)]),_:2},1024)]),_:2},1040)]),selection:l(({item:a})=>[t(te,{color:a.raw.vendorColor||"#9CA3AF",size:"small",label:""},{default:l(()=>[s(d(a.raw.title)+" ("+d(a.raw.subtitle)+") ",1)]),_:2},1032,["color"])]),_:1},8,["modelValue","items"])]),_:1}),t(M,null,{default:l(()=>[t(N),t(n,{variant:"text",onClick:e[17]||(e[17]=a=>V.value=!1)},{default:l(()=>[...e[40]||(e[40]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"primary",onClick:ie},{default:l(()=>[...e[41]||(e[41]=[s("Speichern",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:D.value,"onUpdate:modelValue":e[20]||(e[20]=a=>D.value=a),"max-width":"400"},{default:l(()=>[t(y,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[42]||(e[42]=[s("Artikel löschen?",-1)])]),_:1}),t(w,null,{default:l(()=>[s(' Möchtest du "'+d(S.value?.productName)+'" wirklich löschen? ',1)]),_:1}),t(M,null,{default:l(()=>[t(N),t(n,{variant:"text",onClick:e[19]||(e[19]=a=>D.value=!1)},{default:l(()=>[...e[43]||(e[43]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"error",onClick:Le},{default:l(()=>[...e[44]||(e[44]=[s("Löschen",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:L.value,"onUpdate:modelValue":e[22]||(e[22]=a=>L.value=a),"max-width":"400"},{default:l(()=>[t(y,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[45]||(e[45]=[s("Liste leeren?",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[46]||(e[46]=[s(" Möchtest du wirklich alle Artikel aus der Einkaufsliste löschen? ",-1)])]),_:1}),t(M,null,{default:l(()=>[t(N),t(n,{variant:"text",onClick:e[21]||(e[21]=a=>L.value=!1)},{default:l(()=>[...e[47]||(e[47]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"error",onClick:De},{default:l(()=>[...e[48]||(e[48]=[s("Liste leeren",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},st=He(lt,[["__scopeId","data-v-74ac56d5"]]);export{st as default};
