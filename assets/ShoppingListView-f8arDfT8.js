import{q as Oe,p as He,x as Ze,y as qe,i as _,j as Q,c as L,s as Re,a as x,g as p,d as k,e as t,z as P,h as l,r,F as B,f as W,o as u,b as g,t as d,k as s,A as ke,n as _e,w as X,l as be,B as ye,C as we,v as Y}from"./index-B-kHOwZx.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Je={class:"shopping-list-view"},Qe={class:"d-flex align-center justify-space-between"},We={class:"text-body-2"},Xe={class:"d-flex align-center justify-space-between mb-2"},Ye={class:"text-body-2"},et={class:"d-flex gap-4"},tt={key:3},lt={class:"vendor-header mb-2"},at={class:"d-flex align-center gap-1"},ot={class:"text-caption"},nt={key:0},st={__name:"ShoppingListView",setup(ut){const c=Oe(),y=He(),K=Ze(),ee=qe(),j=_(!1),A=_(null),S=_(!1),v=_({name:"",amount:null,unit:"",categoryId:null}),T=_(!1),I=_(!1),m=_({id:null,name:"",amount:1,unit:"Stück",categoryId:null}),O=_(!1),D=_(!1),F=_(!1),V=_(null),se=_(!1),H=_(!1),te=_(!0),le=_(new Set);Q(()=>v.value.name,o=>{if(T.value)return;if(!o||o.trim().length<2){v.value.categoryId=null;return}const e=o.toLowerCase().trim(),n=ee.products.find(i=>i.name.toLowerCase()===e);n&&n.categoryId&&(v.value.categoryId=n.categoryId)}),Q(S,o=>{o&&(v.value={name:"",amount:null,unit:"",categoryId:null},T.value=!1)}),Q(()=>m.value.name,o=>{if(O.value||!o||o.trim().length<2)return;const e=o.toLowerCase().trim(),n=ee.products.find(i=>i.name.toLowerCase()===e);n&&n.categoryId&&(m.value.categoryId=n.categoryId)}),Q(I,o=>{o||(m.value={id:null,name:"",amount:1,unit:"Stück",categoryId:null},O.value=!1)});const he=L(()=>c.shoppingList?.items?c.shoppingList.items.filter(o=>le.value.has(o.id)?!0:!(!H.value&&o.checked||!te.value&&o.freshnessStatus==="wait")):[]),ue=L(()=>{const o={};for(const e of he.value){const n=e.vendorName||"Sonstiges";o[n]||(o[n]={name:n,color:e.vendorColor||"#9CA3AF",categories:{}});const i=e.categoryName||"Sonstiges";o[n].categories[i]||(o[n].categories[i]=[]),o[n].categories[i].push(e)}return Object.values(o).map(e=>({...e,categories:Object.entries(e.categories).map(([n,i])=>({name:n,items:i})).sort((n,i)=>n.name.localeCompare(i.name))}))}),ae=L(()=>c.shoppingList?.items?.filter(o=>o.checked).length||0),z=L(()=>c.shoppingList?.items?.length||0),Ce=L(()=>ae.value>0),re=L(()=>{const o=[];o.push({value:null,title:"Sonstiges",subtitle:"Manuell hinzugefügt"});for(const e of K.vendors){const n=K.getCategoriesForVendor(e.id);for(const i of n)o.push({value:i.id,title:i.name,subtitle:e.name,vendorColor:e.color})}return o});async function xe(o){!o.checked&&!H.value?(le.value.add(o.id),await c.toggleItem(o.id),setTimeout(()=>{le.value.delete(o.id)},500)):await c.toggleItem(o.id)}function Ve(){c.removeCheckedItems(),y.showSnackbar("Erledigte Artikel entfernt")}async function ie(){if(!v.value.name.trim()){y.showSnackbar("Name ist erforderlich","error");return}try{const o=v.value.amount?parseFloat(v.value.amount):null,e=await Y.addShoppingItem({productName:v.value.name.trim(),amount:o,unit:v.value.unit||null,categoryId:v.value.categoryId});c.shoppingList&&c.shoppingList.items.push(e);const n=v.value.name.trim();S.value=!1,v.value={name:"",amount:null,unit:"",categoryId:null},T.value=!1,y.showSnackbar(`${n} hinzugefügt`)}catch{y.showSnackbar("Fehler beim Hinzufügen","error")}}function Se(o){A.value=o,j.value=!0}function Ie(o){switch(o){case"today":return"error";case"wait":return"warning";default:return"success"}}function ze(o){switch(o){case"today":return"mdi-clock-alert";case"wait":return"mdi-clock-outline";default:return"mdi-check-circle"}}function Z(o){if(!o)return"";const e=new Date(o);return`${["So","Mo","Di","Mi","Do","Fr","Sa"][e.getDay()]}, ${e.getDate()}.${e.getMonth()+1}.`}Re(()=>{K.fetchVendors(),K.fetchCategories(),ee.fetchProducts(),c.loadCurrentList()});function Le(o){v.value.categoryId=o,T.value=!0}function Ae(o){m.value.categoryId=o,O.value=!0}function de(o){if(!o.sources?.some(e=>e.manual)){y.showSnackbar("Nur manuell hinzugefügte Artikel können bearbeitet werden","warning");return}m.value={id:o.id,name:o.productName,amount:o.amount,unit:o.unit,categoryId:o.categoryId},O.value=!1,I.value=!0}async function me(){if(!m.value.name.trim()){y.showSnackbar("Name ist erforderlich","error");return}try{const o=m.value.name.trim(),e=m.value.amount!==null&&m.value.amount!==""&&m.value.amount!==void 0?parseFloat(m.value.amount):null;await Y.updateShoppingItem(m.value.id,{productName:o,amount:e,unit:m.value.unit||null,categoryId:m.value.categoryId}),await c.loadCurrentList(),I.value=!1,y.showSnackbar(`${o} aktualisiert`)}catch{y.showSnackbar("Fehler beim Aktualisieren","error")}}function De(o){V.value=o,F.value=!0}async function Fe(){if(V.value)try{const o=V.value.productName;if(await Y.deleteShoppingItem(V.value.id),c.shoppingList?.items){const e=c.shoppingList.items.findIndex(n=>n.id===V.value.id);e!==-1&&c.shoppingList.items.splice(e,1)}F.value=!1,V.value=null,y.showSnackbar(`${o} gelöscht`)}catch{y.showSnackbar("Fehler beim Löschen","error")}}async function Ne(){try{await Y.clearShoppingList(),c.shoppingList&&(c.shoppingList.items=[]),D.value=!1,y.showSnackbar("Einkaufsliste geleert")}catch{y.showSnackbar("Fehler beim Leeren der Liste","error")}}return(o,e)=>{const n=r("v-btn"),i=r("v-icon"),q=r("v-list-item-title"),N=r("v-list-item"),oe=r("v-list"),Ee=r("v-menu"),w=r("v-card-text"),b=r("v-card"),$e=r("v-progress-linear"),ce=r("v-switch"),ne=r("v-chip"),Me=r("v-list-subheader"),Ue=r("v-checkbox-btn"),R=r("v-list-item-subtitle"),Pe=r("v-tooltip"),Be=r("v-progress-circular"),E=r("v-card-title"),G=r("v-text-field"),J=r("v-col"),ve=r("v-combobox"),fe=r("v-row"),pe=r("v-avatar"),ge=r("v-select"),$=r("v-spacer"),M=r("v-card-actions"),U=r("v-dialog"),Ke=r("v-card-subtitle");return u(),x("div",Je,[P(c).shoppingList?(u(),p(b,{key:0,class:"mb-4",variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"pa-3"},{default:l(()=>[g("div",Qe,[g("div",null,[e[23]||(e[23]=g("div",{class:"text-subtitle-2 text-medium-emphasis"},"Einkaufsliste",-1)),g("div",We," Zuletzt erstellt am "+d(Z(P(c).shoppingList.generatedAt.split("T")[0])),1)]),t(Ee,{modelValue:se.value,"onUpdate:modelValue":e[1]||(e[1]=a=>se.value=a),location:"bottom end"},{activator:l(({props:a})=>[t(n,ke({icon:"mdi-dots-vertical",variant:"text",size:"small"},a),null,16)]),default:l(()=>[t(oe,{density:"compact"},{default:l(()=>[t(N,{onClick:e[0]||(e[0]=a=>D.value=!0)},{prepend:l(()=>[t(i,{icon:"mdi-delete-sweep"})]),default:l(()=>[t(q,null,{default:l(()=>[...e[24]||(e[24]=[s("Liste leeren",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})):k("",!0),z.value>0?(u(),p(b,{key:1,class:"mb-4",variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"pa-3"},{default:l(()=>[g("div",Xe,[g("span",Ye,d(ae.value)+" von "+d(z.value)+" erledigt",1),Ce.value?(u(),p(n,{key:0,variant:"text",color:"error",size:"small",onClick:Ve},{default:l(()=>[...e[25]||(e[25]=[s(" Erledigte löschen ",-1)])]),_:1})):k("",!0)]),t($e,{"model-value":ae.value/z.value*100,color:"primary",height:"8",rounded:""},null,8,["model-value"])]),_:1})]),_:1})):k("",!0),z.value>0?(u(),p(b,{key:2,class:"mb-4",variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"pa-3"},{default:l(()=>[g("div",et,[t(ce,{modelValue:H.value,"onUpdate:modelValue":e[2]||(e[2]=a=>H.value=a),color:"primary",label:"Erledigte anzeigen","hide-details":"",density:"compact"},null,8,["modelValue"]),t(ce,{modelValue:te.value,"onUpdate:modelValue":e[3]||(e[3]=a=>te.value=a),color:"primary",label:"Zukünftige anzeigen","hide-details":"",density:"compact"},null,8,["modelValue"])])]),_:1})]),_:1})):k("",!0),P(c).shoppingList?(u(),x("div",tt,[ue.value.length===0&&z.value>0?(u(),p(b,{key:0,variant:"flat",color:"surface",class:"mb-4"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(i,{icon:"mdi-filter-off-outline",size:"64",color:"warning",class:"mb-4"}),e[26]||(e[26]=g("div",{class:"text-h6 mb-2"},"Keine Artikel zum Anzeigen",-1)),e[27]||(e[27]=g("div",{class:"text-body-2 text-medium-emphasis"}," Alle Artikel sind für später vorgesehen. Deaktiviere den Filter, um sie zu sehen. ",-1))]),_:1})]),_:1})):k("",!0),z.value===0?(u(),p(b,{key:1,variant:"flat",color:"surface",class:"mb-4"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(i,{icon:"mdi-cart-outline",size:"64",color:"primary",class:"mb-4"}),e[28]||(e[28]=g("div",{class:"text-h6 mb-2"},"Einkaufsliste ist leer",-1)),e[29]||(e[29]=g("div",{class:"text-body-2 text-medium-emphasis"}," Füge Artikel manuell hinzu oder erstelle eine Liste aus deinen geplanten Mahlzeiten. ",-1))]),_:1})]),_:1})):k("",!0),(u(!0),x(B,null,W(ue.value,a=>(u(),x("div",{key:a.name,class:"mb-4"},[g("div",lt,[t(ne,{color:a.color,variant:"flat",size:"small",label:""},{default:l(()=>[t(i,{start:"",icon:"mdi-store",size:"small"}),s(" "+d(a.name),1)]),_:2},1032,["color"])]),t(b,{variant:"flat",color:"surface"},{default:l(()=>[t(oe,{density:"compact"},{default:l(()=>[(u(!0),x(B,null,W(a.categories,(C,je)=>(u(),x(B,{key:C.name},[je>0||a.categories.length>1?(u(),p(Me,{key:0,class:"category-separator"},{default:l(()=>[s(d(C.name),1)]),_:2},1024)):k("",!0),(u(!0),x(B,null,W(C.items,f=>(u(),p(N,{key:f.id,class:_e({"item-checked":f.checked}),onClick:h=>f.sources?.some(Te=>Te.manual)?de(f):null},{prepend:l(()=>[t(Ue,{"model-value":f.checked,color:"primary",onClick:X(h=>xe(f),["stop"])},null,8,["model-value","onClick"])]),append:l(()=>[g("div",at,[f.freshnessStatus==="wait"?(u(),p(Pe,{key:0,location:"top"},{activator:l(({props:h})=>[t(i,ke({ref_for:!0},h,{icon:ze(f.freshnessStatus),color:Ie(f.freshnessStatus),size:"small"}),null,16,["icon","color"])]),default:l(()=>[g("div",null,[g("div",null," Frühestens kaufen ab: "+d(Z(f.earliestPurchaseDate)),1),g("div",ot," Benötigt am "+d(Z(f.earliestUseDate)),1)])]),_:2},1024)):k("",!0),f.sources?.length?(u(),p(n,{key:1,icon:"mdi-information-outline",variant:"text",size:"x-small",onClick:X(h=>Se(f),["stop"])},null,8,["onClick"])):k("",!0),f.sources?.some(h=>h.manual)?(u(),p(n,{key:2,icon:"mdi-pencil",variant:"text",size:"x-small",onClick:X(h=>de(f),["stop"])},null,8,["onClick"])):k("",!0),f.sources?.some(h=>h.manual)?(u(),p(n,{key:3,icon:"mdi-delete",variant:"text",size:"x-small",color:"error",onClick:X(h=>De(f),["stop"])},null,8,["onClick"])):k("",!0)])]),default:l(()=>[t(q,{class:_e({"text-decoration-line-through":f.checked})},{default:l(()=>[s(d(f.productName),1)]),_:2},1032,["class"]),t(R,null,{default:l(()=>[s(d(f.displayAmount),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))],64))),128))]),_:2},1024)]),_:2},1024)]))),128))])):P(c).loading?(u(),p(b,{key:5,variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(Be,{indeterminate:"",color:"primary"}),e[32]||(e[32]=g("div",{class:"mt-4"},"Lade Einkaufsliste...",-1))]),_:1})]),_:1})):(u(),p(b,{key:4,variant:"flat",color:"surface"},{default:l(()=>[t(w,{class:"text-center pa-8"},{default:l(()=>[t(i,{icon:"mdi-cart-outline",size:"64",color:"primary",class:"mb-4"}),e[30]||(e[30]=g("div",{class:"text-h6 mb-2"},"Keine Einkaufsliste",-1)),e[31]||(e[31]=g("div",{class:"text-body-2 text-medium-emphasis"},' Erstelle eine Einkaufsliste im Planer, indem du Mahlzeiten hinzufügst und auf "Einkaufsliste erstellen" klickst. ',-1))]),_:1})]),_:1})),P(c).loading?k("",!0):(u(),p(n,{key:6,color:"accent",icon:"mdi-plus",size:"large",position:"fixed",location:"bottom end",class:"mb-16 mr-4",elevation:"4",onClick:e[4]||(e[4]=a=>S.value=!0)})),t(U,{modelValue:S.value,"onUpdate:modelValue":e[10]||(e[10]=a=>S.value=a),"max-width":"400"},{default:l(()=>[t(b,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[33]||(e[33]=[s("Artikel hinzufügen",-1)])]),_:1}),t(w,null,{default:l(()=>[t(G,{modelValue:v.value.name,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.name=a),label:"Produkt",autofocus:"",class:"mb-3",onKeyup:be(ie,["enter"])},null,8,["modelValue"]),t(fe,null,{default:l(()=>[t(J,{cols:"6"},{default:l(()=>[t(G,{modelValue:v.value.amount,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value.amount=a),modelModifiers:{number:!0},label:"Menge",type:"number",inputmode:"decimal",min:"0",step:"0.1"},null,8,["modelValue"])]),_:1}),t(J,{cols:"6"},{default:l(()=>[t(ve,{modelValue:v.value.unit,"onUpdate:modelValue":e[7]||(e[7]=a=>v.value.unit=a),items:["Stück","g","kg","ml","l","Packung","Bund","Paar"],label:"Einheit"},null,8,["modelValue"])]),_:1})]),_:1}),t(ge,{modelValue:v.value.categoryId,"onUpdate:modelValue":[e[8]||(e[8]=a=>v.value.categoryId=a),Le],items:re.value,"item-title":"title","item-value":"value",label:"Kategorie",class:"mt-3"},{item:l(({item:a,props:C})=>[t(N,ye(we(C)),{prepend:l(()=>[t(pe,{color:a.raw.vendorColor||"#9CA3AF",size:"24",class:"mr-2"},{default:l(()=>[t(i,{icon:"mdi-store",size:"small",color:"white"})]),_:1},8,["color"])]),default:l(()=>[t(R,null,{default:l(()=>[s(d(a.raw.subtitle),1)]),_:2},1024)]),_:2},1040)]),selection:l(({item:a})=>[t(ne,{color:a.raw.vendorColor||"#9CA3AF",size:"small",label:""},{default:l(()=>[s(d(a.raw.title)+" ("+d(a.raw.subtitle)+") ",1)]),_:2},1032,["color"])]),_:1},8,["modelValue","items"])]),_:1}),t(M,null,{default:l(()=>[t($),t(n,{variant:"text",onClick:e[9]||(e[9]=a=>S.value=!1)},{default:l(()=>[...e[34]||(e[34]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"primary",onClick:ie},{default:l(()=>[...e[35]||(e[35]=[s("Hinzufügen",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:j.value,"onUpdate:modelValue":e[12]||(e[12]=a=>j.value=a),"max-width":"400"},{default:l(()=>[A.value?(u(),p(b,{key:0},{default:l(()=>[t(E,null,{default:l(()=>[s(d(A.value.productName),1)]),_:1}),t(Ke,null,{default:l(()=>[s(d(A.value.displayAmount),1)]),_:1}),t(w,null,{default:l(()=>[e[37]||(e[37]=g("div",{class:"text-subtitle-2 mb-2"},"Verwendet für:",-1)),t(oe,{density:"compact"},{default:l(()=>[(u(!0),x(B,null,W(A.value.sources,(a,C)=>(u(),p(N,{key:C},{default:l(()=>[a.dishName?(u(),p(q,{key:0},{default:l(()=>[s(d(a.dishName),1)]),_:2},1024)):a.manual?(u(),p(q,{key:1},{default:l(()=>[...e[36]||(e[36]=[s(" Manuell hinzugefügt ",-1)])]),_:1})):k("",!0),a.mealDate?(u(),p(R,{key:2},{default:l(()=>[s(d(Z(a.mealDate))+" · "+d(a.mealSlot)+" ",1),a.amount&&a.amount!==0?(u(),x("span",nt," · "+d(a.amount)+" "+d(a.unit),1)):k("",!0)]),_:2},1024)):k("",!0)]),_:2},1024))),128))]),_:1})]),_:1}),t(M,null,{default:l(()=>[t($),t(n,{variant:"text",onClick:e[11]||(e[11]=a=>j.value=!1)},{default:l(()=>[...e[38]||(e[38]=[s("Schließen",-1)])]),_:1})]),_:1})]),_:1})):k("",!0)]),_:1},8,["modelValue"]),t(U,{modelValue:I.value,"onUpdate:modelValue":e[18]||(e[18]=a=>I.value=a),"max-width":"400"},{default:l(()=>[t(b,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[39]||(e[39]=[s("Artikel bearbeiten",-1)])]),_:1}),t(w,null,{default:l(()=>[t(G,{modelValue:m.value.name,"onUpdate:modelValue":e[13]||(e[13]=a=>m.value.name=a),label:"Produkt",autofocus:"",class:"mb-3",onKeyup:be(me,["enter"])},null,8,["modelValue"]),t(fe,null,{default:l(()=>[t(J,{cols:"6"},{default:l(()=>[t(G,{modelValue:m.value.amount,"onUpdate:modelValue":e[14]||(e[14]=a=>m.value.amount=a),modelModifiers:{number:!0},label:"Menge",type:"number",inputmode:"decimal",min:"0",step:"0.1"},null,8,["modelValue"])]),_:1}),t(J,{cols:"6"},{default:l(()=>[t(ve,{modelValue:m.value.unit,"onUpdate:modelValue":e[15]||(e[15]=a=>m.value.unit=a),items:["Stück","g","kg","ml","l","Packung","Bund","Paar"],label:"Einheit"},null,8,["modelValue"])]),_:1})]),_:1}),t(ge,{modelValue:m.value.categoryId,"onUpdate:modelValue":[e[16]||(e[16]=a=>m.value.categoryId=a),Ae],items:re.value,"item-title":"title","item-value":"value",label:"Kategorie",class:"mt-3"},{item:l(({item:a,props:C})=>[t(N,ye(we(C)),{prepend:l(()=>[t(pe,{color:a.raw.vendorColor||"#9CA3AF",size:"24",class:"mr-2"},{default:l(()=>[t(i,{icon:"mdi-store",size:"small",color:"white"})]),_:1},8,["color"])]),default:l(()=>[t(R,null,{default:l(()=>[s(d(a.raw.subtitle),1)]),_:2},1024)]),_:2},1040)]),selection:l(({item:a})=>[t(ne,{color:a.raw.vendorColor||"#9CA3AF",size:"small",label:""},{default:l(()=>[s(d(a.raw.title)+" ("+d(a.raw.subtitle)+") ",1)]),_:2},1032,["color"])]),_:1},8,["modelValue","items"])]),_:1}),t(M,null,{default:l(()=>[t($),t(n,{variant:"text",onClick:e[17]||(e[17]=a=>I.value=!1)},{default:l(()=>[...e[40]||(e[40]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"primary",onClick:me},{default:l(()=>[...e[41]||(e[41]=[s("Speichern",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:F.value,"onUpdate:modelValue":e[20]||(e[20]=a=>F.value=a),"max-width":"400"},{default:l(()=>[t(b,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[42]||(e[42]=[s("Artikel löschen?",-1)])]),_:1}),t(w,null,{default:l(()=>[s(' Möchtest du "'+d(V.value?.productName)+'" wirklich löschen? ',1)]),_:1}),t(M,null,{default:l(()=>[t($),t(n,{variant:"text",onClick:e[19]||(e[19]=a=>F.value=!1)},{default:l(()=>[...e[43]||(e[43]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"error",onClick:Fe},{default:l(()=>[...e[44]||(e[44]=[s("Löschen",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(U,{modelValue:D.value,"onUpdate:modelValue":e[22]||(e[22]=a=>D.value=a),"max-width":"400"},{default:l(()=>[t(b,null,{default:l(()=>[t(E,null,{default:l(()=>[...e[45]||(e[45]=[s("Liste leeren?",-1)])]),_:1}),t(w,null,{default:l(()=>[...e[46]||(e[46]=[s(" Möchtest du wirklich alle Artikel aus der Einkaufsliste löschen? ",-1)])]),_:1}),t(M,null,{default:l(()=>[t($),t(n,{variant:"text",onClick:e[21]||(e[21]=a=>D.value=!1)},{default:l(()=>[...e[47]||(e[47]=[s("Abbrechen",-1)])]),_:1}),t(n,{color:"error",onClick:Ne},{default:l(()=>[...e[48]||(e[48]=[s("Liste leeren",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},dt=Ge(st,[["__scopeId","data-v-1223c5ad"]]);export{dt as default};
